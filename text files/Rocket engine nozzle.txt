Rocket engine nozzle
A rocket engine nozzle is a propelling nozzle (usually of the de Laval type) used in a rocket engine to expand and accelerate combustion products to high supersonic velocities.
Simply: propellants pressurized by either pumps or high pressure ullage gas to anywhere between two to several hundred atmospheres are injected into a combustion chamber to burn, and the combustion chamber leads into a nozzle which converts the energy contained in high pressure, high temperature combustion products into kinetic energy by accelerating the gas to high velocity and near-ambient pressure.

History
Simple bell-shaped nozzles were developed in the 1500s. The de Laval nozzle was originally developed in the 19th century by Gustaf de Laval for use in steam turbines. It was first used in an early rocket engine developed by Robert Goddard, one of the fathers of modern rocketry. It has since been used in almost all rocket engines, including Walter Thiel's implementation, which made possible Germany's V-2 rocket.
Atmospheric use
The optimal size of a rocket engine nozzle is achieved when the exit pressure equals ambient (atmospheric) pressure, which decreases with increasing altitude. The reason for this is as follows: using a quasi-one-dimensional approximation of the flow, if ambient pressure is higher than the exit pressure, it decreases the net thrust produced by the rocket, which can be seen through a force-balance analysis. If ambient pressure is lower, while the force balance indicates that the thrust will increase, the isentropic Mach relations show that the area ratio of the nozzle could have been greater, which would result in a higher exit velocity of the propellant, increasing thrust. For rockets traveling from the Earth to orbit, a simple nozzle design is only optimal at one altitude, losing efficiency and wasting fuel at other altitudes.
Just past the throat, the pressure of the gas is higher than ambient pressure and needs to be lowered between the throat and the nozzle exit by expansion. If the pressure of the exhaust leaving the nozzle exit is still above ambient pressure, then a nozzle is said to be underexpanded; if the exhaust is below ambient pressure, then it is overexpanded. 
Slight overexpansion causes a slight reduction in efficiency, but otherwise does little harm. However, if the exit pressure is less than approximately 40% that of ambient, then "flow separation" occurs. This can cause exhaust instabilities that can cause damage to the nozzle, control difficulties of the vehicle or the engine, and in more extreme cases, destruction of the engine.
In some cases, it is desirable for reliability and safety reasons to ignite a rocket engine on the ground that will be used all the way to orbit. For optimal liftoff performance, the pressure of the gases exiting nozzle should be at sea-level pressure when the rocket is near sea level (at takeoff). However, a nozzle designed for sea-level operation will quickly lose efficiency at higher altitudes. In a multi-stage design, the second stage rocket engine is primarily designed for use at high altitudes, only providing additional thrust after the first-stage engine performs the initial liftoff. In this case, designers will usually opt for an overexpanded nozzle (at sea level) design for the second stage, making it more efficient at higher altitudes, where the ambient pressure is lower. This was the technique employed on the Space Shuttle's overexpanded (at sea level) main engines (SSMEs), which spent most of their powered trajectory in near-vacuum, while the shuttle's two sea-level efficient solid rocket boosters provided the majority of the initial liftoff thrust. In the vacuum of space virtually all nozzles are underexpanded because to fully expand the gas’s the nozzle would have to be infinitely long, as a result engineers have to choose a design which will take advantage of the extra expansion (thrust and efficiency) whilst also not adding excessive weight and compromising the vehicle’s performance.
Vacuum use
For nozzles that are used in vacuum or at very high altitude, it is impossible to match ambient pressure; rather, nozzles with larger area ratio are usually more efficient. However, a very long nozzle has significant mass, a drawback in and of itself. A length that optimises overall vehicle performance typically has to be found. Additionally, as the temperature of the gas in the nozzle decreases, some components of the exhaust gases (such as water vapour from the combustion process) may condense or even freeze. This is highly undesirable and needs to be avoided.
Magnetic nozzles have been proposed for some types of propulsion (for example, Variable Specific Impulse Magnetoplasma Rocket, VASIMR), in which the flow of plasma or ions are directed by magnetic fields instead of walls made of solid materials. These can be advantageous, since a magnetic field itself cannot melt, and the plasma temperatures can reach millions of kelvins. However, there are often thermal design challenges presented by the coils themselves, particularly if superconducting coils are used to form the throat and expansion fields.

Aerostatic back-pressure and optimal expansion
As the gas travels down the expansion part of the nozzle, the pressure and temperature decrease, while the speed of the gas increases.
The supersonic nature of the exhaust jet means that the pressure of the exhaust can be significantly different from ambient pressure – the outside air is unable to equalize the pressure upstream due to the very high jet velocity. Therefore, for supersonic nozzles, it is actually possible for the pressure of the gas exiting the nozzle to be significantly below or very greatly above ambient pressure.
If the exit pressure is too low, then the jet can separate from the nozzle. This is often unstable, and the jet will generally cause large off-axis thrusts and may mechanically damage the nozzle.
This separation generally occurs if the exit pressure drops below roughly 30–45% of ambient, but separation may be delayed to far lower pressures if the nozzle is designed to increase the pressure at the rim, as is achieved with the SSME (1–2 psi at 15 psi ambient). 
In addition, as the rocket engine starts up or throttles, the chamber pressure varies, and this generates different levels of efficiency. At low chamber pressures the engine is almost inevitably going to be grossly over-expanded.
Optimal shape
The ratio of the area of the narrowest part of the nozzle to the exit plane area is mainly what determines how efficiently the expansion of the exhaust gases is converted into linear velocity, the exhaust velocity, and therefore the thrust of the rocket engine. The gas properties have an effect as well.
The shape of the nozzle also modestly affects how efficiently the expansion of the exhaust gases is converted into linear motion. The simplest nozzle shape has a ~15° cone half-angle, which is about 98% efficient. Smaller angles give very slightly higher efficiency, larger angles give lower efficiency.
More complex shapes of revolution are frequently used, such as bell nozzles or parabolic shapes. These give perhaps 1% higher efficiency than the cone nozzle and can be shorter and lighter. They are widely used on launch vehicles and other rockets where weight is at a premium. They are, of course, harder to fabricate, so are typically more costly.
There is also a theoretically optimal nozzle shape for maximal exhaust speed. However, a shorter bell shape is typically used, which gives better overall performance due to its much lower weight, shorter length, lower drag losses, and only very marginally lower exhaust speed. 
Other design aspects affect the efficiency of a rocket nozzle. The nozzle's throat should have a smooth radius. The internal angle that narrows to the throat also has an effect on the overall efficiency, but this is small. The exit angle of the nozzle needs to be as small as possible (about 12°) in order to minimize the chances of separation problems at low exit pressures.

